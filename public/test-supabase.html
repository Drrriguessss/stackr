<!DOCTYPE html>
<html>
<head>
    <title>Test Supabase Connection</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>🔍 Test de connexion Supabase</h1>
    <div id="results"></div>
    
    <script>
        async function testConnection() {
            const resultsDiv = document.getElementById('results');
            
            try {
                resultsDiv.innerHTML += '<p>🔄 Initialisation du client Supabase...</p>';
                
                // Note: Ces valeurs seront visibles dans le code source, mais c'est juste pour le test
                const supabase = window.supabase.createClient(
                    'https://jptdjsmzywyzvaseqojv.supabase.co',
                    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpwdGRqc216eXd5enZhc2Vxb2p2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwNzA1MzUsImV4cCI6MjA2ODY0NjUzNX0.8JRvA1qhSagdK3fzuFeN1QBTPUXJf8WktTriwmF1tIs'
                );
                
                resultsDiv.innerHTML += '<p>✅ Client créé</p>';
                
                // Test de connexion basique
                const { data, error } = await supabase
                    .from('library_items')
                    .select('*')
                    .limit(1);
                
                if (error) {
                    resultsDiv.innerHTML += `<p style="color: red;">❌ Erreur: ${error.message}</p>`;
                    resultsDiv.innerHTML += `<p style="color: red;">Code: ${error.code}</p>`;
                } else {
                    resultsDiv.innerHTML += `<p style="color: green;">✅ Connexion réussie!</p>`;
                    resultsDiv.innerHTML += `<p>📊 Nombre d'items: ${data.length}</p>`;
                }
                
                // Test realtime
                resultsDiv.innerHTML += '<p>🔄 Test du realtime...</p>';
                const channel = supabase
                    .channel('test')
                    .on('postgres_changes', {
                        event: '*',
                        schema: 'public',
                        table: 'library_items'
                    }, (payload) => {
                        resultsDiv.innerHTML += `<p style="color: blue;">📡 Changement détecté: ${payload.eventType}</p>`;
                    })
                    .subscribe((status) => {
                        resultsDiv.innerHTML += `<p style="color: purple;">📡 Statut realtime: ${status}</p>`;
                    });
                
            } catch (err) {
                resultsDiv.innerHTML += `<p style="color: red;">💥 Erreur complète: ${err.message}</p>`;
            }
        }
        
        // Lancer le test au chargement de la page
        testConnection();
    </script>
</body>
</html>